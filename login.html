<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á IT</title>
<link rel="stylesheet" href="./css/style.css">
<link rel="stylesheet" href="./css/ui.css">
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet"> 
<style>
body{
  font-family: Tahoma, sans-serif;
  background:#f0f2f5;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.box{
  width:380px;
  background:#fff;
  padding:20px;
  border-radius:8px;
  box-shadow:0 4px 10px rgba(0,0,0,.15);
}
h2{
  text-align:center;
  margin-bottom:15px;
}
input{
  width:100%;
  padding:8px;
  margin:6px 0;
}
button{
  width:100%;
  padding:10px;
  background:#2c3e50;
  color:#fff;
  border:none;
  border-radius:4px;
  cursor:pointer;
}
button:hover{
  background:#34495e;
}
.link{
  text-align:center;
  margin-top:10px;
  color:#2980b9;
  cursor:pointer;
}
.hidden{
  display:none;
}
.msg{
  text-align:center;
  margin-top:10px;
  color:red;
}
</style>
</head>

<body>

<div class="box">

  <!-- LOGIN -->
  <div id="loginBox">
    <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
    <input id="loginEmail" placeholder="Email">
    <input id="loginPassword" type="password" placeholder="Password">
    <button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <div class="link" onclick="showRegister()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</div>
    <div id="loginMsg" class="msg"></div>
  </div>

  <!-- REGISTER -->
  <div id="registerBox" class="hidden">
    <h2>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å IT</h2>
    <input id="regName" placeholder="‡∏ä‡∏∑‡πà‡∏≠ - ‡∏™‡∏Å‡∏∏‡∏•">
    <input id="regEmail" placeholder="Email">
    <input id="regPassword" type="password" placeholder="Password">
    <button onclick="register()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
    <div class="link" onclick="showLogin()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Login</div>
    <div id="regMsg" class="msg"></div>
  </div>

</div>

<script>
const GAS_URL = 'https://script.google.com/macros/s/AKfycbzNSgpYNigJX7W-RUPq8SLN4e687pE55p72KsbM-nWFcPefKDhjzYAflsm78i42IW7qrw/exec'; // üî¥ ‡πÉ‡∏™‡πà Web App URL

function jsonp(url, cb){
  const s=document.createElement('script');
  s.src=url+'&callback='+cb;
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),3000);
}

/* UI */
function showRegister(){
  loginBox.classList.add('hidden');
  registerBox.classList.remove('hidden');
}
function showLogin(){
  registerBox.classList.add('hidden');
  loginBox.classList.remove('hidden');
}

/* LOGIN */
function login(){
  loginMsg.innerHTML='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';

  jsonp(
    GAS_URL+
    '?action=login'+
    '&email='+encodeURIComponent(loginEmail.value)+
    '&password='+encodeURIComponent(loginPassword.value),
    'loginCallback'
  );
}

function loginCallback(res){
  if(res.success){
    alert('‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö '+res.user.name);
    // üëâ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
    // location.href = 'dashboard.html';
  }else{
    loginMsg.innerHTML=res.message;
  }
}

/* REGISTER */
function register(){
  regMsg.innerHTML='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';

  jsonp(
    GAS_URL+
    '?action=register'+
    '&name='+encodeURIComponent(regName.value)+
    '&email='+encodeURIComponent(regEmail.value)+
    '&password='+encodeURIComponent(regPassword.value),
    'registerCallback'
  );
}

function registerCallback(res){
  if(res.success){
    alert(res.message);
    showLogin();
  }else{
    regMsg.innerHTML=res.message;
  }
}
</script>

</body>
</html>
