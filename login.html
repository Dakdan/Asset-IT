<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Login | IT Maintenance</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="./css/style.css">
  <link rel="stylesheet" href="./css/ui.css">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet">
</head>

<body class="login-page">

<div class="login-wrapper">

  <div class="login-header">
    <img src="./‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ.png" class="header-logo">
    <h1>‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ</h1>
    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á IT</p>
  </div>

  <div class="login-card">
    <h2 style="text-align:center;margin-bottom:20px;">üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>

    <div class="form-group">
      <input id="email" type="email" placeholder="Email" autocomplete="username">
    </div>

    <div class="form-group">
      <input id="password" type="password" placeholder="Password" autocomplete="current-password">
    </div>

    <button class="btn-login" id="loginBtn" onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>

    <div class="register-link">
      <a href="./register.html">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</a>
    </div>
  </div>

</div>

<!-- OVERLAY -->
<div id="overlay" class="overlay hidden">
  <div class="overlay-card">
    <div class="spinner"></div>
    <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...</p>
  </div>
</div>

<!-- POPUP -->
<div id="popup" class="popup hidden">
  <div class="popup-card">
    <h3 id="popupTitle">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
    <p id="popupMessage"></p>
    <button onclick="closePopup()">‡∏ï‡∏Å‡∏•‡∏á</button>
  </div>
</div>

<script src="./js/api.js"></script>
<script src="./js/ui.js"></script>
<script src="./js/main.js"></script>

<script>
async function login() {
  const email = emailInput.value.trim();
  const password = passwordInput.value.trim();
  const btn = document.getElementById("loginBtn");

  if (!email || !password) {
    showPopup("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡πÅ‡∏•‡∏∞ Password");
    return;
  }

  btn.disabled = true;
  showOverlay("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...");

  try {
    const res = await callAPI("login", { email, password });
    if (res.success) {
      localStorage.setItem("it_session", JSON.stringify(res.user));
      location.href = "./index.html";
    } else {
      showPopup("‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", res.message);
    }
  } catch {
    showPopup("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ");
  } finally {
    hideOverlay();
    btn.disabled = false;
  }
}

document.addEventListener("keydown", e => {
  if (e.key === "Enter") login();
});

const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
</script>

</body>
</html>
