<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ระบบซ่อมบำรุง IT</title>

<!-- STYLE หลัก -->
<link rel="stylesheet" href="./css/style.css">
<link rel="stylesheet" href="./css/ui.css">

<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet">
</head>

<body class="login-page">

<div class="login-wrapper">

  <div class="login-header">
    <h1>ระบบซ่อมบำรุง IT</h1>
    <p>สำหรับเจ้าหน้าที่เทคโนโลยีสารสนเทศ</p>
  </div>

  <div class="login-card">

    <!-- LOGIN -->
    <div id="loginBox">
      <h2>เข้าสู่ระบบ</h2>

      <div class="form-group">
        <input id="loginEmail" placeholder="Email">
      </div>

      <div class="form-group">
        <input id="loginPassword" type="password" placeholder="Password">
      </div>

      <button onclick="login()">เข้าสู่ระบบ</button>

      <div class="register-link">
        <a onclick="showRegister()">สมัครสมาชิก</a>
      </div>

      <div id="loginMsg" class="msg"></div>
    </div>

    <!-- REGISTER -->
    <div id="registerBox" class="hidden">
      <h2>สมัครสมาชิก IT</h2>

      <div class="form-group">
        <input id="regName" placeholder="ชื่อ - สกุล">
      </div>

      <div class="form-group">
        <input id="regEmail" placeholder="Email">
      </div>

      <div class="form-group">
        <input id="regPassword" type="password" placeholder="Password">
      </div>

      <button onclick="register()">สมัครสมาชิก</button>

      <div class="register-link">
        <a onclick="showLogin()">กลับไปหน้า Login</a>
      </div>

      <div id="regMsg" class="msg"></div>
    </div>

  </div>
</div>

<script>
const GAS_URL = 'https://script.google.com/macros/s/AKfycbzNSgpYNigJX7W-RUPq8SLN4e687pE55p72KsbM-nWFcPefKDhjzYAflsm78i42IW7qrw/exec';

function jsonp(url, cb){
  const s = document.createElement('script');
  s.src = url + '&callback=' + cb;
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),3000);
}

/* UI */
function showRegister(){
  loginBox.classList.add('hidden');
  registerBox.classList.remove('hidden');
}

function showLogin(){
  registerBox.classList.add('hidden');
  loginBox.classList.remove('hidden');
}

/* LOGIN */
function login(){
  loginMsg.innerHTML = 'กำลังตรวจสอบ...';

  jsonp(
    GAS_URL +
    '?action=login' +
    '&email=' + encodeURIComponent(loginEmail.value) +
    '&password=' + encodeURIComponent(loginPassword.value),
    'loginCallback'
  );
}

function loginCallback(res){
  if(res.success){
    alert('ยินดีต้อนรับ ' + res.user.name);
    // location.href = 'admin.html';
  }else{
    loginMsg.innerHTML = res.message;
  }
}

/* REGISTER */
function register(){
  regMsg.innerHTML = 'กำลังบันทึกข้อมูล...';

  jsonp(
    GAS_URL +
    '?action=register' +
    '&name=' + encodeURIComponent(regName.value) +
    '&email=' + encodeURIComponent(regEmail.value) +
    '&password=' + encodeURIComponent(regPassword.value),
    'registerCallback'
  );
}

function registerCallback(res){
  if(res.success){
    alert(res.message);
    showLogin();
  }else{
    regMsg.innerHTML = res.message;
  }
}
</script>

</body>
</html>
