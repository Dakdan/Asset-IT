<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Change Password</title>
<link rel="stylesheet" href="./css/style.css">
</head>

<body class="login-page">

<div class="login-wrapper">
  <div class="login-header">
    <h1>เปลี่ยนรหัสผ่าน</h1>
    <p>ครั้งแรกต้องเปลี่ยน</p>
  </div>

  <div class="login-card">
    <div class="form-group">
      <input id="newpw" type="password" placeholder="รหัสผ่านใหม่">
    </div>
    <button class="btn-login" onclick="changePW()">บันทึก</button>
  </div>
</div>

<div id="overlay" class="overlay hidden">
  <div class="overlay-card">
    <div class="spinner"></div>
    <p>กำลังบันทึก...</p>
  </div>
</div>

<div id="popup" class="popup hidden">
  <div class="popup-card">
    <p id="popupMsg"></p>
    <button onclick="closePopup()">ตกลง</button>
  </div>
</div>

<script>
const user = JSON.parse(localStorage.getItem('it_user'));

function showOverlay(){ overlay.classList.remove('hidden'); }
function hideOverlay(){ overlay.classList.add('hidden'); }
function showPopup(msg){
  popupMsg.innerText = msg;
  popup.classList.remove('hidden');
}
function closePopup(){ popup.classList.add('hidden'); }

function changePW(){
  showOverlay();
  jsonp(
    GAS_URL +
    '?action=changePassword' +
    '&user=' + user.userid +
    '&newpw=' + encodeURIComponent(newpw.value),
    'cb'
  );
}

function cb(res){
  hideOverlay();
  if(res.success){
    showPopup('เปลี่ยนรหัสผ่านสำเร็จ');
    setTimeout(()=>location.href='login.html',1500);
  }else{
    showPopup('เกิดข้อผิดพลาด');
  }
}
</script>

</body>
</html>
