<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><title>Change Password</title></head>
<body>
  <h2>Change Password</h2>
  <input id="p1" type="password" placeholder="New password">
  <input id="p2" type="password" placeholder="Confirm password">
  <button onclick="change()">Save</button>

  <script>
    const API = 'https://script.google.com/macros/s/DEPLOY_ID/exec';

    async function change() {
      if (p1.value !== p2.value) return alert('Password mismatch');

      const r = await fetch(API, {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + localStorage.getItem('session_token'),
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ action: 'changePassword', newPassword: p1.value })
      });

      const j = await r.json();
      if (!j.ok) return alert(j.message);
      location.replace('index.html');
    }
  </script>

  <script src="session-guard.js"></script>
</body>
</html>
