<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Admin Approve</title>
<link rel="stylesheet" href="./css/style.css">
<link rel="stylesheet" href="./css/ui.css">
</head>

<body>
<h2>รายการรออนุมัติ</h2>

<table id="tbl">
<thead>
<tr>
  <th>Email</th>
  <th>Status</th>
  <th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div id="overlay" class="overlay hidden"></div>
<div id="popup" class="popup hidden"></div>

<script src="./js/api.js"></script>
<script src="./js/ui.js"></script>

<script>
function load() {
  callAPI('getRegister').then(res=>{
    const body = document.querySelector('#tbl tbody');
    body.innerHTML='';
    res.data.forEach((r,i)=>{
      if (i===0 || r[10]!=='ACTIVE') return;
      body.innerHTML+=`
        <tr>
          <td>${r[1]}</td>
          <td>${r[10]}</td>
          <td><button onclick="approve('${r[1]}')">อนุมัติ</button></td>
        </tr>`;
    });
  });
}

function approve(email) {
  showOverlay();
  callAPI('approve',{email})
    .then(r=>{
      hideOverlay();
      showPopup('ผลลัพธ์', r.message);
      load();
    });
}

load();
</script>
</body>
</html>
