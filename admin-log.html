<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Admin Log</title>
<link rel="stylesheet" href="./css/style.css">
</head>

<body class="login-page">

<div class="login-wrapper" style="max-width:900px">
  <div class="login-card">
    <h2>LOG ระบบ</h2>
    <table class="table">
      <thead>
        <tr>
          <th>เวลา</th>
          <th>Action</th>
          <th>User</th>
        </tr>
      </thead>
      <tbody id="logTable"></tbody>
    </table>
  </div>
</div>

<div id="overlay" class="overlay hidden">
  <div class="overlay-card">
    <div class="spinner"></div>
    <p>กำลังโหลด...</p>
  </div>
</div>

<script>
const admin = JSON.parse(localStorage.getItem('it_user'));
if(!admin || admin.role !== 'ADMIN'){
  location.href='login.html';
}

function showOverlay(){ overlay.classList.remove('hidden'); }
function hideOverlay(){ overlay.classList.add('hidden'); }

function loadLog(){
  showOverlay();
  jsonp(
    GAS_URL + '?action=getLogs&admin=' + admin.userid,
    'render'
  );
}

function render(res){
  hideOverlay();
  logTable.innerHTML='';
  res.data.forEach(l=>{
    logTable.innerHTML += `
      <tr>
        <td>${l.time}</td>
        <td>${l.action}</td>
        <td>${l.user}</td>
      </tr>`;
  });
}

loadLog();
</script>

</body>
</html>
